<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <title>결제 현황</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
        />
        <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
        <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
        <style>
            * {
                font-family: "Inter", sans-serif;
            }
            ::-webkit-scrollbar {
                display: none;
            }
            html,
            body {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .submenu {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-in-out;
            }
            .submenu.active {
                max-height: 500px;
            }
            .arrow {
                transition: transform 0.3s ease-in-out;
            }
            .arrow.rotated {
                transform: rotate(90deg);
            }
        </style>
    </head>
    <body class="h-full text-base-content bg-neutral-50">
        <header id="header" class="bg-white border-b border-neutral-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fa-solid fa-hospital text-2xl text-neutral-700"></i>
                    <h1 class="text-xl text-neutral-900">병원 관리 시스템</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <img
                            src="https://api.dicebear.com/7.x/notionists/svg?scale=200&seed=789"
                            alt="User Avatar"
                            class="w-8 h-8 rounded-full"
                        />
                        <span class="text-sm text-neutral-700">김의사</span>
                    </div>
                    <button class="px-3 py-1 text-sm text-neutral-600 hover:text-neutral-900">
                        <i class="fa-solid fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="h-full flex">
            <aside id="sidebar" class="w-64 bg-neutral-50 border-r border-neutral-200 p-6">
                <nav class="space-y-2">
                    <!-- 일정 관리 -->
                    <div class="menu-item">
                        <span
                            onclick="toggleSubmenu('schedule-submenu')"
                            class="flex items-center justify-between px-3 py-2 text-neutral-700 hover:bg-neutral-200 rounded-md cursor-pointer"
                        >
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-calendar-days"></i>
                                <span>일정 관리</span>
                            </div>
                            <i class="fa-solid fa-chevron-right arrow text-sm" id="schedule-arrow"></i>
                        </span>
                        <div id="schedule-submenu" class="submenu ml-6 mt-1 space-y-1">
                            <a
                                href="main.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-clock"></i>
                                <span>월별 일정</span>
                            </a>
                            <a
                                href="weeklySchedule.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-calendar-week"></i>
                                <span>주간 일정</span>
                            </a>
                            <a
                                href="appointmentManage.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-user-clock"></i>
                                <span>예약 관리</span>
                            </a>
                        </div>
                    </div>
                    <!-- 환자 관리 -->
                    <div class="menu-item">
                        <span
                            onclick="toggleSubmenu('patient-submenu')"
                            class="flex items-center justify-between px-3 py-2 text-neutral-700 hover:bg-neutral-200 rounded-md cursor-pointer"
                        >
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-users"></i>
                                <span>환자 관리</span>
                            </div>
                            <i class="fa-solid fa-chevron-right arrow text-sm" id="patient-arrow"></i>
                        </span>
                        <div id="patient-submenu" class="submenu ml-6 mt-1 space-y-1">
                            <a
                                href="patientList.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-list"></i>
                                <span>환자 목록</span>
                            </a>
                        </div>
                    </div>
                    <!-- 진료 기록 -->
                    <div class="menu-item">
                        <span
                            onclick="toggleSubmenu('record-submenu')"
                            class="flex items-center justify-between px-3 py-2 text-neutral-700 hover:bg-neutral-200 rounded-md cursor-pointer"
                        >
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-file-medical"></i>
                                <span>진료 기록</span>
                            </div>
                            <i class="fa-solid fa-chevron-right arrow text-sm" id="record-arrow"></i>
                        </span>
                        <div id="record-submenu" class="submenu ml-6 mt-1 space-y-1">
                            <a
                                href="patientDgnsLst.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-file-lines"></i>
                                <span>환자별 진료 기록</span>
                            </a>
                        </div>
                    </div>
                    <!-- 통계 (현재 활성화) -->
                    <div class="menu-item">
                        <span
                            onclick="toggleSubmenu('stats-submenu')"
                            class="flex items-center justify-between px-3 py-2 bg-neutral-900 text-white rounded-md cursor-pointer"
                        >
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-chart-bar"></i>
                                <span>통계</span>
                            </div>
                            <i class="fa-solid fa-chevron-right arrow text-sm text-white" id="stats-arrow"></i>
                        </span>
                        <div id="stats-submenu" class="submenu ml-6 mt-1 space-y-1">
                            <a
                                href="patient-stats.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-user-chart"></i>
                                <span>진료 통계</span>
                            </a>
                            <a
                                href="revenue-stats.html"
                                class="flex items-center space-x-3 px-3 py-2 bg-neutral-100 text-neutral-900 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-won-sign"></i>
                                <span>결제 현황</span>
                            </a>
                            <a
                                href="disease-stats.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-chart-pie"></i>
                                <span>정산 현황</span>
                            </a>
                        </div>
                    </div>
                    <!-- 설정 -->
                    <div class="menu-item">
                        <span
                            onclick="toggleSubmenu('settings-submenu')"
                            class="flex items-center justify-between px-3 py-2 text-neutral-700 hover:bg-neutral-200 rounded-md cursor-pointer"
                        >
                            <div class="flex items-center space-x-3">
                                <i class="fa-solid fa-cog"></i>
                                <span>설정</span>
                            </div>
                            <i class="fa-solid fa-chevron-right arrow text-sm" id="settings-arrow"></i>
                        </span>
                        <div id="settings-submenu" class="submenu ml-6 mt-1 space-y-1">
                            <a
                                href="profile-settings.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-user-gear"></i>
                                <span>병원 정보 설정</span>
                            </a>
                            <a
                                href="clinic-settings.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-hospital"></i>
                                <span>병원 시간 설정</span>
                            </a>
                            <a
                                href="backup-settings.html"
                                class="flex items-center space-x-3 px-3 py-2 text-neutral-600 hover:bg-neutral-100 rounded-md text-sm cursor-pointer"
                            >
                                <i class="fa-solid fa-database"></i>
                                <span>-</span>
                            </a>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- 메인 콘텐츠 -->
            <section class="flex-1 p-6 overflow-y-auto">
                <div class="mb-6">
                    <h2 class="text-2xl text-neutral-900 mb-4">결제 현황</h2>

                    <!-- 검색 영역 -->
                    <div class="bg-white rounded-lg border border-neutral-200 p-4 mb-6">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-neutral-700">기간</span>
                                <input
                                    type="date"
                                    class="px-3 py-2 border border-neutral-300 rounded-lg"
                                    id="dateFrom"
                                />
                                <span class="text-neutral-500">~</span>
                                <input type="date" class="px-3 py-2 border border-neutral-300 rounded-lg" id="dateTo" />
                            </div>
                            <select class="px-3 py-2 border border-neutral-300 rounded-lg">
                                <option value="">전체</option>
                                <option value="member">회원명</option>
                                <option value="patient">환자명</option>
                            </select>
                            <input
                                type="text"
                                class="flex-1 px-3 py-2 border border-neutral-300 rounded-lg"
                                placeholder="검색어를 입력하세요"
                            />
                            <button class="px-4 py-2 bg-neutral-900 text-white rounded-lg hover:bg-neutral-800">
                                검색
                            </button>
                        </div>
                    </div>

                    <!-- 결제 목록 -->
                    <div class="bg-white rounded-lg border border-neutral-200 p-4">
                        <div id="payment-grid"></div>
                    </div>

                    <!-- 결제 상세 정보 -->
                    <div class="mt-6 bg-white rounded-lg border border-neutral-200 p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">결제 상세 정보</h3>
                            <button
                                class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
                                onclick="showCancelPopup()"
                            >
                                결제 취소
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">번호</span>
                                    <span id="payment-number" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">결제 방식</span>
                                    <span id="payment-method" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">환자명</span>
                                    <span id="patient-name" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">결제액</span>
                                    <span id="payment-amount" class="font-medium">-</span>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">결제 번호</span>
                                    <span id="payment-id" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">회원명</span>
                                    <span id="member-name" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">결제 완료 금액</span>
                                    <span id="completed-amount" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-neutral-200">
                                    <span class="text-neutral-600">결제일</span>
                                    <span id="payment-date" class="font-medium">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 결제 취소 확인 팝업 -->
        <div id="cancel-popup" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
            <div class="bg-white rounded-lg p-6 w-96">
                <h3 class="text-lg font-medium mb-4">결제 취소 확인</h3>
                <p class="text-neutral-600 mb-6">선택한 결제를 취소하시겠습니까?</p>
                <div class="flex justify-end space-x-3">
                    <button class="px-4 py-2 text-neutral-600 hover:text-neutral-900" onclick="hideCancelPopup()">
                        취소
                    </button>
                    <button
                        class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
                        onclick="cancelPayment()"
                    >
                        확인
                    </button>
                </div>
            </div>
        </div>

        <script>
            // 가짜 데이터 생성
            const sampleData = [
                ["1", "2025-08-20", "150,000", "김환자", "김환자", "카드결제", "완료", "-"],
                ["2", "2025-08-19", "85,000", "이보호자", "이환자", "계좌이체", "완료", "-"],
                ["3", "2025-08-18", "220,000", "박환자", "박환자", "카드결제", "취소", "2025-08-19"],
                ["4", "2025-08-17", "95,000", "최보호자", "최환자", "카드결제", "완료", "-"],
                ["5", "2025-08-16", "180,000", "정환자", "정환자", "카드결제", "취소", "2025-08-17"],
                ["6", "2025-08-15", "135,000", "강보호자", "강환자", "계좌이체", "완료", "-"],
                ["7", "2025-08-14", "75,000", "조환자", "조환자", "카드결제", "완료", "-"],
                ["8", "2025-08-13", "160,000", "윤보호자", "윤환자", "카드결제", "완료", "-"],
                ["9", "2025-08-12", "195,000", "장환자", "장환자", "계좌이체", "취소", "2025-08-13"],
                ["10", "2025-08-11", "110,000", "임보호자", "임환자", "카드결제", "완료", "-"],
            ];

            // 가짜 상세 정보 데이터
            const sampleDetails = {
                1: {
                    number: "1",
                    method: "카드결제 (신한카드)",
                    patientName: "김환자",
                    amount: "150,000원",
                    paymentId: "P202508200001",
                    memberName: "김환자",
                    completedAmount: "150,000원",
                    paymentDate: "2025-08-20 14:30:00",
                },
            };

            // 그리드 초기화
            const grid = new gridjs.Grid({
                columns: ["번호", "결제일", "결제금액", "회원명", "환자명", "결제구분", "상태", "취소일"],
                data: sampleData,
                style: {
                    table: {
                        border: "1px solid #e5e7eb",
                    },
                    th: {
                        "background-color": "#f3f4f6",
                        "border-bottom": "1px solid #e5e7eb",
                        "text-align": "center",
                    },
                    td: {
                        "text-align": "center",
                    },
                },
            }).render(document.getElementById("payment-grid"));

            // 그리드 row 클릭 이벤트 처리
            grid.on("rowClick", (params, row) => {
                const rowId = row.cells[0].data; // 첫 번째 열(번호)
                const details = sampleDetails[rowId];

                if (details) {
                    // 상세 정보 업데이트
                    document.getElementById("payment-number").textContent = details.number;
                    document.getElementById("payment-method").textContent = details.method;
                    document.getElementById("patient-name").textContent = details.patientName;
                    document.getElementById("payment-amount").textContent = details.amount;
                    document.getElementById("payment-id").textContent = details.paymentId;
                    document.getElementById("member-name").textContent = details.memberName;
                    document.getElementById("completed-amount").textContent = details.completedAmount;
                    document.getElementById("payment-date").textContent = details.paymentDate;
                }
            });

            // 사이드바 토글 함수
            function toggleSubmenu(submenuId) {
                const submenu = document.getElementById(submenuId);
                const arrow = document.getElementById(submenuId.replace("-submenu", "-arrow"));
                const isActive = submenu.classList.contains("active");
                const allSubmenus = document.querySelectorAll(".submenu");
                const allArrows = document.querySelectorAll(".arrow");

                allSubmenus.forEach((menu) => menu.classList.remove("active"));
                allArrows.forEach((arr) => arr.classList.remove("rotated"));

                if (!isActive) {
                    submenu.classList.add("active");
                    arrow.classList.add("rotated");
                }
            }

            // 결제 취소 팝업 표시
            function showCancelPopup() {
                document.getElementById("cancel-popup").style.display = "flex";
            }

            // 결제 취소 팝업 숨기기
            function hideCancelPopup() {
                document.getElementById("cancel-popup").style.display = "none";
            }

            // 결제 취소 처리
            function cancelPayment() {
                // TODO: 결제 취소 로직 구현
                hideCancelPopup();
            }

            // 페이지 로드 시 결제 메뉴 활성화
            document.addEventListener("DOMContentLoaded", function () {
                toggleSubmenu("stats-submenu");

                // 오늘 날짜 기본값 설정
                const today = new Date();
                const dateFrom = document.getElementById("dateFrom");
                const dateTo = document.getElementById("dateTo");

                dateFrom.valueAsDate = today;
                dateTo.valueAsDate = today;
            });
        </script>
    </body>
</html>
